# Chapter: Monitoring with Operations Manager 

## Alert-Generating Rule
The following procedure explains the process to create an alert rule by creating a basic Windows Event Log alert rule. The rule generates an alert if a Operating System crash has been detected. Follow these steps:
1. Open the Operations console and navigate to **Authoring -> Management Pack Objects**.
2. Right-click **Rule** and select **Create New Rule**.
3. Select **Alert Generating Rules -> Event Based -> NT Event Log (Alert)**.
4. Create a new management pack: select **New** and enter **Sample** as the name of your new  Management pack.
5. Click Next to continue.
6. Name for this rule: **Crash detected**.
7. Target the **Windows Server Operating System** class so this rule will apply to all Windows servers.
8. Leave the rule enabled and click Next to continue.
9. On the following page, select the **System Event log**. You can click the ... button to browse and select the log, or you can simply type in the name of the log.
10. Click Next.
11. Use the **Build Event Expression** page in the wizard to match the Event ID and Event Source parameters. Configure the Event ID as **Event ID Equals 6008** and the Event Source to be **Event Source Equals EventLog**.
12. Click Next to continue.
13. The final page of the Create Rule Wizard configures the actual alert OpsMgr will generate. Leave the alert with the default name. Notice this rule has a **Priority of Medium** and a **Severity level of Critical**.
14. Click Create to create the new alert rule.

## Confirm that a changed management pack is downloaded by the agent
Confirming that a change in the monitoring environment is confirmed by the agent is an extremely important and usefull procedure. You will use it a lot during the training, as well as in real life.
1. Open the Event Viewer.
1. From Event Viewer, connect to LON-DC1.
1. Open the **Applications and Services** node, click the **Operations Manager** log and search for event id **1201**.
1. Minimize the Virtual Machine connection window to return to the host server.
1. In Hyper-V Manager, right click **LON-DC1** and click **Turn Off**.
1. By turning off the server, instead of shutting down, we simulate an Operating System crash.
1. After the DC has been turned off, turn it back on, and wait for the boot procedure.
1. Return to the LON-SV1 Virtual Machine Connection window and open the Operations Manager console and wait for the alert to appear.

## Alert-Generating Rules
1. Repeat the first procedure with the following parameters: 
  - Name: Reason for expected shutdown.
  - Log: System
  - Source: USER32
  - Event ID: 1074 
1. Now repeat the procedure to confirm the management pack download
1. Minimize the Virtual Machine connection window to return to the host server.
1. In Hyper-V Manager, doubleclick **LON-DC1** to open a console window.
1. Log on to LON-DC1 and click Start -> Shutdown. Enter a reason and click Ok. Wait for the VM to shut down and restart the VM.
1. Return to the Operations Manager console. The reason for the shutdown is logged in the Windows Event Log and picked up by the Operations Manager Agent. It will appear in the Operations Manager console.

> NOTE: CLOSING ALERTS
> 
> When you configure an alert using an alert-generating rule, the resulting alert does not close automatically, as is the case with alerts generated by monitors. You must close these alerts manually after resolving the root cause, or they will be auto-resolved after a set amount of time has passed based on your management group settings.

